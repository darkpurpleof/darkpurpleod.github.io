<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sorry we're not hiring!</title>
    <style>
        :root {
            --light-bg: #f8d7da;
            --light-color: #721c24;
            --dark-bg: #2c2c2c;
            --dark-color: #f8d7da;
            --card-bg-light: #ffffff;
            --card-bg-dark: #3c3c3c;
            --border-light: #f5c6cb;
            --border-dark: #555;
            --button-bg-light: #ffffff;
            --button-bg-dark: #3c3c3c;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: var(--light-bg);
            color: var(--light-color);
            text-align: center;
            padding: 20px;
            transition: background-color 0.3s, color 0.3s;
        }
        .dark-mode {
            background-color: var(--dark-bg);
            color: var(--dark-color);
        }
        h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
        }
        .info-chart {
            margin: 20px auto;
            padding: 15px;
            background-color: var(--card-bg-light);
            border: 1px solid var(--border-light);
            border-radius: 10px;
            display: inline-block;
            text-align: left;
            transition: background-color 0.3s, border-color 0.3s;
        }
        .dark-mode .info-chart {
            background-color: var(--card-bg-dark);
            border-color: var(--border-dark);
        }
        .info-chart table {
            width: 100%;
            border-collapse: collapse;
        }
        .info-chart th, .info-chart td {
            padding: 10px;
            border-bottom: 1px solid var(--border-light);
        }
        .dark-mode .info-chart th, .dark-mode .info-chart td {
            border-bottom: 1px solid var(--border-dark);
        }
        .info-chart th {
            text-align: left;
            font-weight: bold;
        }
        .appeal-note {
            margin-top: 20px;
            font-size: 1.2em;
        }
        a {
            color: #0056b3;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        .dropdown {
            position: fixed;
            left: 10px;
            bottom: 10px;
            background-color: var(--card-bg-light);
            border: 1px solid var(--border-light);
            border-radius: 5px;
            padding: 5px;
            transition: background-color 0.3s, border-color 0.3s;
        }
        .dark-mode .dropdown {
            background-color: var(--card-bg-dark);
            border-color: var(--border-dark);
        }
        select {
            padding: 8px;
            font-size: 1em;
            border-radius: 5px;
            border: 1px solid #ccc;
            background-color: var(--button-bg-light);
            transition: background-color 0.3s;
        }
        .dark-mode select {
            background-color: var(--button-bg-dark);
            border: 1px solid var(--border-dark);
        }
        .dark-light-toggle {
            position: fixed;
            top: 10px;
            right: 10px;
            cursor: pointer;
            background: none;
            border: none;
            font-size: 1.5em;
            color: var(--light-color);
            transition: color 0.3s;
        }
        .dark-mode .dark-light-toggle {
            color: var(--dark-color);
        }
    </style>
</head>
<body>
    <button class="dark-light-toggle" onclick="toggleDarkMode()">☀️</button>

    <div class="dropdown">
        <label for="language" style="margin-right: 5px;">Choose your language:</label>
        <select id="language" onchange="changeLanguage()">
            <option value="en">English</option>
            <option value="ru">Russian</option>
            <option value="es">Spanish</option>
            <option value="el">Greek</option>
            <option value="yi">Yiddish</option>
        </select>
    </div>

    <h1 id="greeting">Sorry we're not hiring!</h1>
    <h2 id="closedMessage">Admin Vacants are closed!</h2>

    <div class="info-chart">
        <table>
            <tr>
                <th>IP:</th>
                <td id="ip-address">Fetching...</td>
            </tr>
            <tr>
                <th>Current Time:</th>
                <td id="current-time">Fetching...</td>
            </tr>
            <tr>
                <th>Next Open Vacant:</th>
                <td id="next-vacant">Pending...</td>
            </tr>
            <tr>
                <th>Hosted By:</th>
                <td id="hosted-by">Fetching...</td>
            </tr>
        </table>
    </div>

    <script>
        async function fetchUserData() {
            try {
                const ipResponse = await fetch('https://ipinfo.io/json?');
                const ipData = await ipResponse.json();
                document.getElementById('ip-address').textContent = ipData.ip || 'Unknown';

                updateTime(); // Start updating current time dynamically

                const vacancyResponse = await fetch('https://darkpurpleof.github.io/recentest.json');
                const vacancyData = await vacancyResponse.json();

                if (!vacancyData || vacancyData.is_allowed === "no") {
                    window.location.href = "https://darkpurpleof.github.io/404";
                    return;
                }

                const vacancyDate = new Date(
                    `${vacancyData.year}-${vacancyData.month}-${vacancyData.day}T${vacancyData.hour}:${vacancyData.minute}:00`);
                const nowUtc = new Date(new Date().getTime() + new Date().getTimezoneOffset() * 60000);
                const timeZoneOffset = -(new Date().getTimezoneOffset() / 60);

                if (vacancyData.form_is_closed === "yes" && nowUtc > vacancyDate) {
                    window.location.href = "mailto:darkpurpleof@outlook.com";
                    return;
                }

                const diffInSeconds = Math.ceil((vacancyDate - nowUtc) / 1000);
                const countdown = getCountdownText(diffInSeconds);
                const formattedDate = `${vacancyData.year}-${String(vacancyData.month).padStart(2, '0')}-` +
                                      `${String(vacancyData.day).padStart(2, '0')} ${String(vacancyData.hour).padStart(2, '0')}:` +
                                      `${String(vacancyData.minute).padStart(2, '0')} (GMT${timeZoneOffset >= 0 ? '+' : ''}${timeZoneOffset})`;

                document.getElementById('next-vacant').textContent = `${formattedDate} (${countdown})`;
                document.getElementById('hosted-by').textContent = vacancyData.hosted_by || "Unknown";

                if (vacancyData.is_standard === "no" && !document.referrer.includes("darkpurpleof.web.app/gofillform")) {
                    document.getElementById('next-vacant').textContent = "Pending...";
                }

            } catch (error) {
                console.error('Error fetching user data:', error);
                document.getElementById('next-vacant').textContent = 'Error fetching data';
                document.getElementById('hosted-by').textContent = 'Error fetching data';
            }
        }

        function updateTime() {
            setInterval(() => {
                const now = new Date();
                const currentDate = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} ` +
                                    `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')} `;
                document.getElementById('current-time').textContent = currentDate;
            }, 1000);
        }

        function getCountdownText(diffInSeconds) {
            if (diffInSeconds > 31536000) {
                const years = Math.floor(diffInSeconds / 31536000);
                return `in ${years} year${years > 1 ? 's' : ''}`;
            } else if (diffInSeconds > 86400) {
                const days = Math.floor(diffInSeconds / 86400);
                return `in ${days} day${days > 1 ? 's' : ''}`;
            } else if (diffInSeconds > 3600) {
                const hours = Math.floor(diffInSeconds / 3600);
                return `in ${hours} hour${hours > 1 ? 's' : ''}`;
            } else if (diffInSeconds > 60) {
                const minutes = Math.floor(diffInSeconds / 60);
                return `in ${minutes} minute${minutes > 1 ? 's' : ''}`;
            } else if (diffInSeconds > 0) {
                return `in ${diffInSeconds} second${diffInSeconds > 1 ? 's' : ''}`;
            } else {
                window.location.href = "https://forms.gle/X62EGQikPSTpEXiP7";
                return "";
            }
        }

        function changeLanguage() {
            const language = document.getElementById('language').value;
            const translations = {
                en: {
                    greeting: "Sorry we're not hiring!",
                    closedMessage: "Admin Vacants are closed!"
                },
                ru: {
                    greeting: "Извините, мы не нанимаем!",
                    closedMessage: "Администраторские вакансии закрыты!"
                },
                es: {
                    greeting: "¡Lo sentimos, no estamos contratando!",
                    closedMessage: "¡Vacantes de administrador están cerradas!"
                },
                el: {
                    greeting: "Συγγνώμη, δεν προσλαμβάνουμε!",
                    closedMessage: "Οι διοικητικές θέσεις είναι κλειστές!"
                },
                yi: {
                    greeting: "אונז זענען נעבעכדיק, מיר נעמען נישט אַרבעטער!",
                    closedMessage: "אַדמין סטעלעס זענען פארשפארט!"
                }
            };

            const translation = translations[language];
            document.getElementById('greeting').textContent = translation.greeting;
            document.getElementById('closedMessage').textContent = translation.closedMessage;
        }

        function toggleDarkMode() {
            const body = document.body;
            body.classList.toggle('dark-mode');
            document.querySelector('.dark-light-toggle').textContent = body.classList.contains('dark-mode') ? '🌙' : '☀️';
        }

        // Automatically detect browser language
        const browserLang = navigator.language.slice(0, 2);
        const supportedLangs = ['en', 'ru', 'es', 'el', 'yi'];
        if (supportedLangs.includes(browserLang)) {
            document.getElementById('language').value = browserLang;
            changeLanguage();
        } else {
            document.getElementById('language').value = 'en';
            changeLanguage();
        }

        // Automatically set theme based on system preference
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        if (prefersDark) {
            toggleDarkMode();
        }

        fetchUserData();
        document.querySelector('.dark-light-toggle').textContent = '☀️';
    </script>
</body>
</html>
